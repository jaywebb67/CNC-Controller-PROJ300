#include "CMSIS/Device/ST/STM32F4xx/Include/stm32f4xx.h"
#include "CMSIS/Device/ST/STM32F4xx/Include/system_stm32f4xx.h"
#include <stdio.h>
#include <stdlib.h>
#include "UART.h"
//#include "Gcode.h"
#include "steppers.h"
#include "clock_config.h"
#include "systick_delay.h"

int main(void)
{
	clock_config180();
	SystemCoreClockUpdate();




	uart3_tx_init();
	stepper_init(1600 ,50);

	//oneRevolution(1,3);

/*	setvbuf(stdin, NULL, _IONBF, 0);

    char *str1 = (char *)malloc(MAX_CHARACTER_PER_LINE * sizeof(char)); // Allocate memory for input
    if (str1 == NULL) {
        printf("Memory allocation failed.");
        return 1;
    }*/
	//int motor;
    /* Loop forever */
	while(1){

/*		GPIOB->ODR |= (1U << z_dir);
		GPIOB->ODR &= ~(1U << stepperEN);
		for (int i =0; i<1600;i++){
			GPIOB->ODR |= (1U << );
			delay_nms(500);
			GPIOB->ODR &= ~(1U << 2);
			delay_nms(500);
		}
		GPIOB->ODR |= (1U << z_dir);

		for (int i =0; i<1600;i++){
			GPIOB->ODR |= (1U << 2);
			delay_nms(500);
			GPIOB->ODR &= ~(1U << 2);
			delay_nms(500);
		}*/

/*		printf("Select the motor to move: ");
		motor = scanf(" %d",&motor);*/

		//delay_nms(2000);

/*
//		printf("Enter G-code Command: ");
//		scanf(" %[^\r]s", str1);
//
//		//printf("\n\rEntered Gcode: %s\n\r",str1);
//		parse_gcode(str1);
*/


	}

//    free(str1);
}
